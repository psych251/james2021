```{r}
library(tidyverse)
library(lme4)
library(ggpirate)
```

```{r}
FR <- read.csv("/Users/madisonparon/Documents/GitHub/james2021/data/pilot/PilotB_cleandata/PilotB_recognition_combined_day1_day2.csv", header=TRUE)
```

Descriptive statistics
```{r}
FR$neighb <- fct_relevel(FR$neighb, c("none", "one", "many")) # order for intuitive printing of means 

FR %>%
  group_by(session) %>%
  summarise(mean = mean(acc), sd = sd(acc))

```
```{r}
FR %>%
  group_by(neighb) %>%
  summarise(mean = mean(acc), sd = sd(acc))
```

```{r}
FR %>%
  group_by(session, neighb) %>%
  summarise(mean = mean(acc), sd = sd(acc))
```

Preparation for analysis

Word Neighbors
```{r}
neighb.contrasts <- cbind(c(-2, 1, 1), c(0,-1,1))
contrasts(FR$neighb) <- neighb.contrasts
contrasts(FR$neighb)
```
Test Session
```{r}
FR$session <- as.factor(FR$session)
session.contrasts <- cbind(c(-2, 1, 1), c(0,-1,1))
contrasts(FR$session) <- session.contrasts
contrasts(FR$session)
```
Vocabulary ability
```{r}
recog$vocabS <- scale(recog$vocabRaw, center = TRUE, scale = TRUE) 
```

Is performance at above chance levels?
```{r}
# Compute participant means for the first session
pptMeans <- FR %>%
  select(ID, session, acc) %>%
  filter(session == 1) %>%
  group_by(ID) %>%
  summarise(mean = mean(acc, na.rm = TRUE))
```

```{r}
# Perform one-sample t-test against chance performance (.5)
t.test(pptMeans$mean, mu=.5, alternative = "greater")
```
Model building
Pruning of fixed effects
```{r}
# Full model with interaction of session and neighb only
fix.full <- glmer(acc ~ session*neighb + (1|ID) + (1|item),
                  data = FR, family = binomial,
                  control = glmerControl(optimizer = "bobyqa"))
```
By-participant random slopes
```{r}
# Model with by-participant slopes for the effect of test session
mod1 <- glmer(acc ~ session*neighb + session*vocabS + neighb*vocabS + (1+session|ID) + (1|item), 
                  data = recog, family = binomial, control = glmerControl(optimizer = "bobyqa"))

```
```{r}
anova(fix.pars, mod1)
```

```{r}
# Model with by-participant slopes for the effect of neighbour condition
mod2 <- glmer(acc ~ session*neighb + session*vocabS + neighb*vocabS + (1+neighb|ID) + (1|item), 
                  data = recog, family = binomial, control = glmerControl(optimizer = "bobyqa"))
anova(fix.pars, mod2)
```
Only random slopes for neighbour condition improved model fit. Check that test session does not contribute beyond this.

```{r}
# Model with by-participant slopes for the effects of neighbour condition and test session
mod2a <- glmer(acc ~ session*neighb + session*vocabS + neighb*vocabS + (1+neighb+session|ID) + (1|item), 
                  data = recog, family = binomial, control = glmerControl(optimizer = "bobyqa"))
```

```{r}
anova(mod2, mod2a)
```
By-item random slopes
```{r}
# Model with by-item slopes for the effect of test session
mod3 <- glmer(acc ~ session*neighb + session*vocabS + neighb*vocabS + (1+neighb|ID) + (1+session|item), 
                  data = recog, family = binomial, control = glmerControl(optimizer = "bobyqa"))
```

```{r}
anova(mod2, mod3)
```
```{r}
# Model with by-item slopes for the effect of vocabulary
mod4 <- glmer(acc ~ session*neighb + session*vocabS + neighb*vocabS + (1+neighb|ID) + (1+vocabS|item), 
                  data = recog, family = binomial, control = glmerControl(optimizer = "bobyqa"))
anova(mod2, mod4)
```

Final model
```{r}
summary(mod2)
```
Plot Graphs
Create participant means
```{r}
cond.means <- recog %>%
  group_by(ID, session, neighb) %>%
  summarise(meanAcc = mean(acc))
```

Recognition for words of different word neighbour conditions at each time point
```{r}
recogGraph <- ggplot(data = cond.means, aes(x=session, y=meanAcc)) +
  theme_bw() + 
  geom_pirate(aes(colour=neighb, fill = neighb), show.legend = TRUE, 
              points_params = list(alpha = 1, size = 3), 
              lines_params = list(size=0.9)) + 
  scale_color_discrete(name = "Word-form neighbours:") +
  scale_fill_discrete(name = "Word-form neighbours:") + 
  scale_x_discrete(name = "Test session", breaks = c(1, 2, 3), labels = c("Same day", "Next day", "Week later")) + 
  scale_y_continuous(name = "Percent correct", labels = scales::percent) + 
  theme(legend.position = "top",
        legend.title = element_text(size = 14),
        legend.text = element_text(size = 14),
        legend.box.background = element_rect(colour = "black"),
        strip.text = element_text(size = 20),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 14)) + 
  geom_hline(yintercept = 0.25, linetype = "dashed") #line to mark chance-level performance
```
```{r}
print(recogGraph)
```
R Version information
```{r}
sessionInfo()

```

